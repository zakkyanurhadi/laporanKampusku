<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Report Details - Campus Reporting System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@splidejs/splide@4.1.4/dist/js/splide.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@splidejs/splide@4.1.4/dist/css/splide.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Inter', sans-serif;
        }
        .mono {
            font-family: 'JetBrains Mono', monospace;
        }
        .timeline-item {
            position: relative;
            padding-left: 2rem;
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: 0.5rem;
            top: 2rem;
            bottom: -1rem;
            width: 2px;
            background-color: #e5e7eb;
        }
        .timeline-item:last-child::before {
            display: none;
        }
        .timeline-dot {
            position: absolute;
            left: 0;
            top: 0.5rem;
            width: 1rem;
            height: 1rem;
            border-radius: 50%;
            border: 2px solid #e5e7eb;
            background-color: white;
            z-index: 10;
        }
        .timeline-dot.active {
            background-color: #3b82f6;
            border-color: #3b82f6;
        }
        .timeline-dot.completed {
            background-color: #10b981;
            border-color: #10b981;
        }
        .status-badge {
            @apply px-3 py-1 rounded-full text-xs font-medium;
        }
        .status-pending { @apply bg-amber-100 text-amber-800; }
        .status-processing { @apply bg-blue-100 text-blue-800; }
        .status-completed { @apply bg-green-100 text-green-800; }
        .status-rejected { @apply bg-red-100 text-red-800; }
        .status-validating { @apply bg-purple-100 text-purple-800; }
        .comment-card {
            transition: all 0.3s ease;
        }
        .comment-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        .image-gallery {
            position: relative;
        }
        .image-gallery img {
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        .image-gallery img:hover {
            transform: scale(1.05);
        }
        .lightbox {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .lightbox.active {
            display: flex;
        }
        .lightbox img {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
        }
        .priority-indicator {
            @apply w-3 h-3 rounded-full;
        }
        .priority-low { @apply bg-green-400; }
        .priority-medium { @apply bg-yellow-400; }
        .priority-high { @apply bg-orange-400; }
        .priority-critical { @apply bg-red-400; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2">
                        <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                        </div>
                        <span class="text-xl font-bold text-gray-900">Campus Reports</span>
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <a href="index.html" class="text-gray-600 hover:text-gray-900 transition-colors">Dashboard</a>
                    <a href="submit-report.html" class="text-gray-600 hover:text-gray-900 transition-colors">Submit Report</a>
                    <a href="admin-dashboard.html" class="text-gray-600 hover:text-gray-900 transition-colors">Admin</a>
                    
                    <!-- User Profile -->
                    <div class="flex items-center space-x-2">
                        <img src="resources/user-avatar-1.jpg" alt="User Avatar" class="w-8 h-8 rounded-full object-cover">
                        <span class="text-sm font-medium text-gray-700">Sarah Johnson</span>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Report Header -->
        <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
            <div class="flex items-start justify-between mb-4">
                <div class="flex-1">
                    <div class="flex items-center space-x-3 mb-2">
                        <h1 class="text-2xl font-bold text-gray-900" id="reportTitle">Broken Light Fixture in Engineering Building</h1>
                        <span class="status-badge status-pending" id="reportStatus">In Progress</span>
                        <div class="flex items-center space-x-1">
                            <div class="priority-indicator priority-medium" id="priorityIndicator"></div>
                            <span class="text-sm text-gray-600" id="priorityText">Medium Priority</span>
                        </div>
                    </div>
                    <p class="text-gray-600 mono text-sm" id="reportId">Report ID: #L2510010004</p>
                </div>
                
                <div class="flex items-center space-x-3">
                    <button class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors" onclick="updateStatus()">
                        Update Status
                    </button>
                    <button class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors" onclick="shareReport()">
                        Share
                    </button>
                    <button class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors" onclick="printReport()">
                        Print
                    </button>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 text-sm">
                <div>
                    <span class="text-gray-600">Submitted by:</span>
                    <div class="flex items-center space-x-2 mt-1">
                        <img src="resources/user-avatar-2.jpg" alt="User" class="w-6 h-6 rounded-full object-cover">
                        <span class="font-medium text-gray-900" id="submittedBy">John Smith</span>
                    </div>
                </div>
                <div>
                    <span class="text-gray-600">Submitted on:</span>
                    <p class="font-medium text-gray-900 mt-1" id="submittedDate">January 15, 2024 at 10:30 AM</p>
                </div>
                <div>
                    <span class="text-gray-600">Category:</span>
                    <p class="font-medium text-gray-900 mt-1" id="category">Infrastructure</p>
                </div>
                <div>
                    <span class="text-gray-600">Assigned to:</span>
                    <p class="font-medium text-gray-900 mt-1" id="assignedTo">Maintenance Team A</p>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Main Content -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Report Description -->
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <h2 class="text-lg font-semibold text-gray-900 mb-4">Problem Description</h2>
                    <p class="text-gray-700 leading-relaxed" id="description">
                        The ceiling light fixture in room 205 of the Engineering Building has been flickering intermittently for the past three days. 
                        The issue occurs during both class hours and after hours, suggesting it's not related to electrical load. 
                        The flickering is severe enough to cause visibility issues during lectures and may pose a safety concern for students with photosensitive conditions.
                    </p>
                </div>

                <!-- Photo Evidence -->
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <h2 class="text-lg font-semibold text-gray-900 mb-4">Photo Evidence</h2>
                    <div class="image-gallery grid grid-cols-2 md:grid-cols-3 gap-4" id="photoGallery">
                        <div class="aspect-video bg-gray-100 rounded-lg overflow-hidden" onclick="openLightbox(0)">
                            <img src="resources/report-sample-1.jpg" alt="Light fixture issue" class="w-full h-full object-cover">
                        </div>
                        <div class="aspect-video bg-gray-100 rounded-lg overflow-hidden" onclick="openLightbox(1)">
                            <img src="resources/report-sample-2.jpg" alt="Close-up of fixture" class="w-full h-full object-cover">
                        </div>
                        <div class="aspect-video bg-gray-100 rounded-lg overflow-hidden" onclick="openLightbox(2)">
                            <img src="resources/report-sample-3.jpg" alt="Room view" class="w-full h-full object-cover">
                        </div>
                    </div>
                </div>

                <!-- Status Timeline -->
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <h2 class="text-lg font-semibold text-gray-900 mb-6">Status Timeline</h2>
                    <div class="space-y-6" id="timeline">
                        <!-- Timeline items will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Comments Section -->
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-lg font-semibold text-gray-900">Discussion</h2>
                        <span class="text-sm text-gray-600" id="commentCount">3 comments</span>
                    </div>
                    
                    <!-- Add Comment -->
                    <div class="mb-6">
                        <div class="flex items-start space-x-3">
                            <img src="resources/user-avatar-1.jpg" alt="Your avatar" class="w-10 h-10 rounded-full object-cover">
                            <div class="flex-1">
                                <textarea id="newComment" rows="3" 
                                          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                          placeholder="Add a comment or update..."></textarea>
                                <div class="flex items-center justify-between mt-3">
                                    <div class="flex items-center space-x-2">
                                        <label class="flex items-center space-x-2 text-sm text-gray-600">
                                            <input type="checkbox" id="internalNote" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                            <span>Internal note only</span>
                                        </label>
                                    </div>
                                    <button class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors" onclick="addComment()">
                                        Post Comment
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Comments List -->
                    <div class="space-y-4" id="commentsList">
                        <!-- Comments will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="space-y-6">
                <!-- Quick Actions -->
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Quick Actions</h3>
                    <div class="space-y-3">
                        <button class="w-full px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-left" onclick="markCompleted()">
                            <div class="flex items-center space-x-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <span>Mark as Completed</span>
                            </div>
                        </button>
                        
                        <button class="w-full px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-left" onclick="assignToTeam()">
                            <div class="flex items-center space-x-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                </svg>
                                <span>Reassign Team</span>
                            </div>
                        </button>
                        
                        <button class="w-full px-4 py-3 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors text-left" onclick="requestInfo()">
                            <div class="flex items-center space-x-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <span>Request More Info</span>
                            </div>
                        </button>
                        
                        <button class="w-full px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-left" onclick="escalateReport()">
                            <div class="flex items-center space-x-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <span>Escalate</span>
                            </div>
                        </button>
                    </div>
                </div>

                <!-- Report Information -->
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Report Information</h3>
                    <div class="space-y-4 text-sm">
                        <div>
                            <span class="text-gray-600">Report ID:</span>
                            <p class="font-medium text-gray-900 mono">L2510010004</p>
                        </div>
                        <div>
                            <span class="text-gray-600">Created:</span>
                            <p class="font-medium text-gray-900">Jan 15, 2024 at 10:30 AM</p>
                        </div>
                        <div>
                            <span class="text-gray-600">Last Updated:</span>
                            <p class="font-medium text-gray-900">Jan 18, 2024 at 2:15 PM</p>
                        </div>
                        <div>
                            <span class="text-gray-600">Estimated Completion:</span>
                            <p class="font-medium text-gray-900">Jan 20, 2024</p>
                        </div>
                        <div>
                            <span class="text-gray-600">Response Time:</span>
                            <p class="font-medium text-green-600">2.4 hours (Excellent)</p>
                        </div>
                    </div>
                </div>

                <!-- Related Reports -->
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Related Reports</h3>
                    <div class="space-y-3">
                        <div class="border border-gray-200 rounded-lg p-3 hover:border-blue-300 cursor-pointer" onclick="viewRelatedReport('L2510010003')">
                            <p class="text-sm font-medium text-gray-900">HVAC Issue in Engineering Building</p>
                            <p class="text-xs text-gray-600 mt-1">Submitted 2 days ago • In Progress</p>
                        </div>
                        <div class="border border-gray-200 rounded-lg p-3 hover:border-blue-300 cursor-pointer" onclick="viewRelatedReport('L2510010002')">
                            <p class="text-sm font-medium text-gray-900">Electrical Outlet Problem - Room 203</p>
                            <p class="text-xs text-gray-600 mt-1">Submitted 1 week ago • Completed</p>
                        </div>
                        <div class="border border-gray-200 rounded-lg p-3 hover:border-blue-300 cursor-pointer" onclick="viewRelatedReport('L2510010001')">
                            <p class="text-sm font-medium text-gray-900">Lighting Issue - Engineering Lobby</p>
                            <p class="text-xs text-gray-600 mt-1">Submitted 2 weeks ago • Completed</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Lightbox -->
    <div id="lightbox" class="lightbox" onclick="closeLightbox()">
        <img id="lightboxImage" src="" alt="">
        <button class="absolute top-4 right-4 text-white text-4xl hover:text-gray-300" onclick="closeLightbox()">&times;</button>
    </div>

    <!-- Status Update Modal -->
    <div id="statusModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-xl p-6 max-w-md w-full mx-4">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-gray-900">Update Status</h3>
                <button onclick="closeStatusModal()" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">New Status</label>
                    <select id="newStatus" class="w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="pending">Pending</option>
                        <option value="processing">In Progress</option>
                        <option value="validating">Waiting for Validation</option>
                        <option value="completed">Completed</option>
                        <option value="rejected">Rejected</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Update Note</label>
                    <textarea id="statusNote" rows="3" class="w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Add a note about this status update..."></textarea>
                </div>
                
                <div class="flex space-x-3 pt-4">
                    <button class="flex-1 bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors" onclick="saveStatusUpdate()">
                        Update Status
                    </button>
                    <button class="flex-1 bg-gray-200 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-300 transition-colors" onclick="closeStatusModal()">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200 mt-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="text-center text-gray-600">
                <p>&copy; 2024 Campus Reporting System. Streamlining university operations through technology.</p>
            </div>
        </div>
    </footer>

    <script>
        // Sample data for demonstration
        const reportData = {
            id: 'L2510010004',
            title: 'Broken Light Fixture in Engineering Building',
            status: 'processing',
            priority: 'medium',
            category: 'Infrastructure',
            submittedBy: 'John Smith',
            submittedDate: '2024-01-15T10:30:00Z',
            assignedTo: 'Maintenance Team A',
            description: 'The ceiling light fixture in room 205 of the Engineering Building has been flickering intermittently for the past three days. The issue occurs during both class hours and after hours, suggesting it\'s not related to electrical load. The flickering is severe enough to cause visibility issues during lectures and may pose a safety concern for students with photosensitive conditions.',
            location: 'Engineering Building, Room 205'
        };

        const timelineData = [
            {
                id: 1,
                status: 'pending',
                title: 'Report Submitted',
                description: 'Issue reported by John Smith',
                timestamp: '2024-01-15T10:30:00Z',
                user: 'John Smith',
                avatar: 'resources/user-avatar-2.jpg',
                type: 'status'
            },
            {
                id: 2,
                status: 'processing',
                title: 'Status Updated',
                description: 'Report assigned to Maintenance Team A for investigation',
                timestamp: '2024-01-15T14:20:00Z',
                user: 'Sarah Johnson',
                avatar: 'resources/user-avatar-1.jpg',
                type: 'status'
            },
            {
                id: 3,
                title: 'Initial Assessment',
                description: 'Team has inspected the fixture. Determined that the ballast needs replacement. Parts have been ordered.',
                timestamp: '2024-01-16T09:15:00Z',
                user: 'Mike Davis',
                avatar: 'resources/user-avatar-1.jpg',
                type: 'comment',
                isInternal: false
            },
            {
                id: 4,
                status: 'validating',
                title: 'Status Updated',
                description: 'Waiting for parts delivery and scheduling',
                timestamp: '2024-01-17T11:30:00Z',
                user: 'Sarah Johnson',
                avatar: 'resources/user-avatar-1.jpg',
                type: 'status'
            },
            {
                id: 5,
                title: 'Parts Received',
                description: 'Replacement ballast has arrived. Scheduled for installation tomorrow morning.',
                timestamp: '2024-01-18T14:15:00Z',
                user: 'Mike Davis',
                avatar: 'resources/user-avatar-1.jpg',
                type: 'comment',
                isInternal: false
            }
        ];

        const commentsData = [
            {
                id: 1,
                author: 'Mike Davis',
                avatar: 'resources/user-avatar-1.jpg',
                content: 'Initial assessment completed. The ballast in the light fixture needs replacement. I\'ve ordered the necessary parts and expect them to arrive by Thursday.',
                timestamp: '2024-01-16T09:15:00Z',
                isInternal: false,
                role: 'Maintenance Supervisor'
            },
            {
                id: 2,
                author: 'Dr. Emily Chen',
                avatar: 'resources/user-avatar-2.jpg',
                content: 'Thank you for the quick response. This issue is affecting my afternoon lectures. Is there any temporary solution while we wait for the parts?',
                timestamp: '2024-01-16T14:30:00Z',
                isInternal: false,
                role: 'Professor'
            },
            {
                id: 3,
                author: 'Mike Davis',
                avatar: 'resources/user-avatar-1.jpg',
                content: 'We can install a temporary portable light fixture for your lectures. I\'ll have someone set it up this afternoon.',
                timestamp: '2024-01-16T16:45:00Z',
                isInternal: false,
                role: 'Maintenance Supervisor'
            }
        ];

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            initializeReportDetail();
            populateTimeline();
            populateComments();
            initializeImageGallery();
        });

        function initializeReportDetail() {
            // Populate report header information
            document.getElementById('reportTitle').textContent = reportData.title;
            document.getElementById('reportId').textContent = `Report ID: #${reportData.id}`;
            document.getElementById('submittedBy').textContent = reportData.submittedBy;
            document.getElementById('category').textContent = reportData.category;
            document.getElementById('assignedTo').textContent = reportData.assignedTo;
            document.getElementById('description').textContent = reportData.description;
            
            // Format dates
            const submittedDate = new Date(reportData.submittedDate);
            document.getElementById('submittedDate').textContent = submittedDate.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: 'numeric',
                minute: '2-digit'
            });
            
            // Update status badge
            const statusElement = document.getElementById('reportStatus');
            statusElement.className = `status-badge status-${reportData.status}`;
            statusElement.textContent = formatStatus(reportData.status);
            
            // Update priority indicator
            const priorityIndicator = document.getElementById('priorityIndicator');
            const priorityText = document.getElementById('priorityText');
            priorityIndicator.className = `priority-indicator priority-${reportData.priority}`;
            priorityText.textContent = `${reportData.priority.charAt(0).toUpperCase() + reportData.priority.slice(1)} Priority`;
        }

        function populateTimeline() {
            const timelineContainer = document.getElementById('timeline');
            timelineContainer.innerHTML = '';
            
            timelineData.forEach((item, index) => {
                const timelineItem = createTimelineItem(item, index === timelineData.length - 1);
                timelineContainer.appendChild(timelineItem);
            });
            
            // Animate timeline items
            anime({
                targets: '.timeline-item',
                translateX: [-50, 0],
                opacity: [0, 1],
                delay: anime.stagger(200),
                duration: 600,
                easing: 'easeOutExpo'
            });
        }

        function createTimelineItem(item, isLast) {
            const div = document.createElement('div');
            div.className = 'timeline-item';
            
            const dotClass = item.status === reportData.status ? 'active' : 'completed';
            const timeAgo = getTimeAgo(item.timestamp);
            
            div.innerHTML = `
                <div class="timeline-dot ${dotClass}"></div>
                <div class="bg-gray-50 rounded-lg p-4">
                    <div class="flex items-start justify-between mb-2">
                        <div class="flex items-center space-x-3">
                            <img src="${item.avatar}" alt="${item.user}" class="w-8 h-8 rounded-full object-cover">
                            <div>
                                <h3 class="font-semibold text-gray-900">${item.title}</h3>
                                <p class="text-sm text-gray-600">${item.user}</p>
                            </div>
                        </div>
                        <span class="text-xs text-gray-500">${timeAgo}</span>
                    </div>
                    <p class="text-sm text-gray-700">${item.description}</p>
                    ${item.type === 'status' && item.status ? `<span class="status-badge status-${item.status} mt-2 inline-block">${formatStatus(item.status)}</span>` : ''}
                </div>
            `;
            
            return div;
        }

        function populateComments() {
            const commentsList = document.getElementById('commentsList');
            const commentCount = document.getElementById('commentCount');
            
            commentsList.innerHTML = '';
            commentCount.textContent = `${commentsData.length} comments`;
            
            commentsData.forEach(comment => {
                const commentElement = createCommentElement(comment);
                commentsList.appendChild(commentElement);
            });
        }

        function createCommentElement(comment) {
            const div = document.createElement('div');
            div.className = 'comment-card border border-gray-200 rounded-lg p-4';
            
            const timeAgo = getTimeAgo(comment.timestamp);
            
            div.innerHTML = `
                <div class="flex items-start space-x-3">
                    <img src="${comment.avatar}" alt="${comment.author}" class="w-10 h-10 rounded-full object-cover">
                    <div class="flex-1">
                        <div class="flex items-center justify-between mb-1">
                            <div>
                                <span class="font-medium text-gray-900">${comment.author}</span>
                                <span class="text-sm text-gray-600 ml-2">${comment.role}</span>
                            </div>
                            <span class="text-xs text-gray-500">${timeAgo}</span>
                        </div>
                        <p class="text-sm text-gray-700">${comment.content}</p>
                    </div>
                </div>
            `;
            
            return div;
        }

        function addComment() {
            const commentText = document.getElementById('newComment').value.trim();
            const isInternal = document.getElementById('internalNote').checked;
            
            if (!commentText) {
                alert('Please enter a comment.');
                return;
            }
            
            const newComment = {
                id: commentsData.length + 1,
                author: 'Sarah Johnson',
                avatar: 'resources/user-avatar-1.jpg',
                content: commentText,
                timestamp: new Date().toISOString(),
                isInternal: isInternal,
                role: 'Administrator'
            };
            
            commentsData.push(newComment);
            
            const commentElement = createCommentElement(newComment);
            document.getElementById('commentsList').appendChild(commentElement);
            
            // Clear form
            document.getElementById('newComment').value = '';
            document.getElementById('internalNote').checked = false;
            
            // Update comment count
            document.getElementById('commentCount').textContent = `${commentsData.length} comments`;
            
            // Animate new comment
            anime({
                targets: commentElement,
                translateY: [20, 0],
                opacity: [0, 1],
                duration: 400,
                easing: 'easeOutExpo'
            });
        }

        function initializeImageGallery() {
            // Initialize Splide carousel if multiple images
            const images = document.querySelectorAll('#photoGallery img');
            if (images.length > 1) {
                new Splide('#photoGallery', {
                    type: 'loop',
                    perPage: 3,
                    perMove: 1,
                    gap: '1rem',
                    breakpoints: {
                        768: {
                            perPage: 2,
                        },
                        480: {
                            perPage: 1,
                        }
                    }
                }).mount();
            }
        }

        function openLightbox(index) {
            const images = ['resources/report-sample-1.jpg', 'resources/report-sample-2.jpg', 'resources/report-sample-3.jpg'];
            const lightbox = document.getElementById('lightbox');
            const lightboxImage = document.getElementById('lightboxImage');
            
            lightboxImage.src = images[index];
            lightbox.classList.add('active');
            
            anime({
                targets: lightbox,
                opacity: [0, 1],
                duration: 300,
                easing: 'easeOutExpo'
            });
        }

        function closeLightbox() {
            const lightbox = document.getElementById('lightbox');
            
            anime({
                targets: lightbox,
                opacity: [1, 0],
                duration: 200,
                easing: 'easeInExpo',
                complete: () => {
                    lightbox.classList.remove('active');
                }
            });
        }

        // Modal functions
        function updateStatus() {
            const modal = document.getElementById('statusModal');
            modal.classList.remove('hidden');
            
            anime({
                targets: modal.querySelector('div'),
                scale: [0.8, 1],
                opacity: [0, 1],
                duration: 300,
                easing: 'easeOutExpo'
            });
        }

        function closeStatusModal() {
            const modal = document.getElementById('statusModal');
            
            anime({
                targets: modal.querySelector('div'),
                scale: [1, 0.8],
                opacity: [1, 0],
                duration: 200,
                easing: 'easeInExpo',
                complete: () => {
                    modal.classList.add('hidden');
                }
            });
        }

        function saveStatusUpdate() {
            const newStatus = document.getElementById('newStatus').value;
            const statusNote = document.getElementById('statusNote').value;
            
            if (!statusNote.trim()) {
                alert('Please add a note for the status update.');
                return;
            }
            
            // Add new timeline item
            const newTimelineItem = {
                id: timelineData.length + 1,
                status: newStatus,
                title: 'Status Updated',
                description: statusNote,
                timestamp: new Date().toISOString(),
                user: 'Sarah Johnson',
                avatar: 'resources/user-avatar-1.jpg',
                type: 'status'
            };
            
            timelineData.push(newTimelineItem);
            
            // Update report status
            reportData.status = newStatus;
            const statusElement = document.getElementById('reportStatus');
            statusElement.className = `status-badge status-${newStatus}`;
            statusElement.textContent = formatStatus(newStatus);
            
            // Refresh timeline
            populateTimeline();
            
            // Close modal
            closeStatusModal();
            
            // Clear form
            document.getElementById('statusNote').value = '';
        }

        // Utility functions
        function formatStatus(status) {
            const statusMap = {
                'pending': 'Pending',
                'processing': 'In Progress',
                'validating': 'Waiting for Validation',
                'completed': 'Completed',
                'rejected': 'Rejected'
            };
            return statusMap[status] || status;
        }

        function getTimeAgo(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffTime = Math.abs(now - date);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            const diffHours = Math.floor(diffTime / (1000 * 60 * 60));
            const diffMinutes = Math.floor(diffTime / (1000 * 60));
            
            if (diffMinutes < 60) return `${diffMinutes} minutes ago`;
            if (diffHours < 24) return `${diffHours} hours ago`;
            if (diffDays === 1) return 'Yesterday';
            if (diffDays < 7) return `${diffDays} days ago`;
            if (diffDays < 30) return `${Math.ceil(diffDays / 7)} weeks ago`;
            return `${Math.ceil(diffDays / 30)} months ago`;
        }

        // Quick action functions
        function markCompleted() {
            if (confirm('Are you sure you want to mark this report as completed?')) {
                // Update status
                reportData.status = 'completed';
                const statusElement = document.getElementById('reportStatus');
                statusElement.className = 'status-badge status-completed';
                statusElement.textContent = 'Completed';
                
                // Add timeline entry
                const completionEntry = {
                    id: timelineData.length + 1,
                    status: 'completed',
                    title: 'Report Completed',
                    description: 'Issue has been resolved and verified',
                    timestamp: new Date().toISOString(),
                    user: 'Sarah Johnson',
                    avatar: 'resources/user-avatar-1.jpg',
                    type: 'status'
                };
                
                timelineData.push(completionEntry);
                populateTimeline();
                
                alert('Report marked as completed successfully!');
            }
        }

        function assignToTeam() {
            alert('Team reassignment feature would open a modal to select new team members.');
        }

        function requestInfo() {
            const commentText = prompt('What additional information do you need?');
            if (commentText) {
                const newComment = {
                    id: commentsData.length + 1,
                    author: 'Sarah Johnson',
                    avatar: 'resources/user-avatar-1.jpg',
                    content: `Request for information: ${commentText}`,
                    timestamp: new Date().toISOString(),
                    isInternal: false,
                    role: 'Administrator'
                };
                
                commentsData.push(newComment);
                populateComments();
            }
        }

        function escalateReport() {
            if (confirm('Are you sure you want to escalate this report? This will notify senior management.')) {
                alert('Report has been escalated to senior management.');
            }
        }

        function shareReport() {
            if (navigator.share) {
                navigator.share({
                    title: `Campus Report: ${reportData.title}`,
                    text: `Report #${reportData.id}: ${reportData.description}`,
                    url: window.location.href
                });
            } else {
                // Fallback: copy to clipboard
                navigator.clipboard.writeText(window.location.href);
                alert('Report link copied to clipboard!');
            }
        }

        function printReport() {
            window.print();
        }

        function viewRelatedReport(reportId) {
            // In a real application, this would navigate to the related report
            alert(`Navigating to related report: ${reportId}`);
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeLightbox();
                closeStatusModal();
            }
        });
    </script>
</body>
</html>